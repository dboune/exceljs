{"version":3,"sources":["../../../lib/doc/workbook.js"],"names":["Worksheet","require","DefinedNames","XLSX","Workbook","module","exports","created","Date","modified","properties","_worksheets","views","media","_definedNames","prototype","xlsx","_xlsx","nextId","i","length","addWorksheet","name","options","id","console","trace","tabColor","argb","theme","indexed","lastOrderNo","reduce","acc","ws","orderNo","worksheetOptions","Object","assign","workbook","worksheet","removeWorksheetEx","removeWorksheet","getWorksheet","destroy","undefined","find","worksheets","slice","sort","a","b","filter","Boolean","eachSheet","iteratee","forEach","sheet","definedNames","clearThemes","_themes","addImage","image","push","type","getImage","model","creator","lastModifiedBy","lastPrinted","map","sheets","company","manager","title","subject","keywords","category","description","language","revision","contentStatus","themes","value","worksheetModel","findIndex"],"mappings":"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","file":"workbook.js","sourcesContent":["/**\n * Copyright (c) 2014-2017 Guyon Roche\n * LICENCE: MIT - please refer to LICENCE file included with this module\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\n */\n\n'use strict';\n\nvar Worksheet = require('./worksheet');\nvar DefinedNames = require('./defined-names');\nvar XLSX = require('./../xlsx/xlsx');\n// var CSV = require('./../csv/csv');\n\n// Workbook requirements\n//  Load and Save from file and stream\n//  Access/Add/Delete individual worksheets\n//  Manage String table, Hyperlink table, etc.\n//  Manage scaffolding for contained objects to write to/read from\n\nvar Workbook = module.exports = function() {\n  this.created = new Date();\n  this.modified = this.created;\n  this.properties = {};\n  this._worksheets = [];\n  this.views = [];\n  this.media = [];\n  this._definedNames = new DefinedNames();\n};\n\nWorkbook.prototype = {\n  get xlsx() {\n    if (!this._xlsx) this._xlsx = new XLSX(this);\n    return this._xlsx;\n  },\n  // get csv() {\n  //   if (!this._csv) this._csv = new CSV(this);\n  //   return this._csv;\n  // },\n  get nextId() {\n    // find the next unique spot to add worksheet\n    var i;\n    for (i = 1; i < this._worksheets.length; i++) {\n      if (!this._worksheets[i]) {\n        return i;\n      }\n    }\n    return this._worksheets.length || 1;\n  },\n  addWorksheet: function(name, options) {\n    var id = this.nextId;\n    name = name || 'sheet' + id;\n    \n    // if options is a color, call it tabColor (and signal deprecated message)\n    if (options) {\n      if (typeof options === 'string') {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: \"rbg value\" } }');\n        options = {\n          properties: {\n            tabColor: {argb: options}\n          }\n        };\n      } else if (options.argb || options.theme || options.indexed) {\n        // eslint-disable-next-line no-console\n        console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }');\n        options = {\n          properties: {\n            tabColor: options\n          }\n        };\n      }\n    }\n\n    var lastOrderNo = this._worksheets.reduce((acc, ws) => ((ws && ws.orderNo) > acc ? ws.orderNo : acc), 0);\n    var worksheetOptions = Object.assign({}, options, {\n      id: id,\n      name: name,\n      orderNo: lastOrderNo + 1,\n      workbook: this\n    });\n\n    var worksheet = new Worksheet(worksheetOptions);\n\n    this._worksheets[id] = worksheet;\n    return worksheet;\n  },\n  removeWorksheetEx: function(worksheet) {\n    delete this._worksheets[worksheet.id];\n  },\n  removeWorksheet: function(id) {\n    var worksheet = this.getWorksheet(id);\n    if (worksheet) {\n      worksheet.destroy();\n    }\n  },\n\n  getWorksheet: function(id) {\n    if (id === undefined) {\n      return this._worksheets.find(function(worksheet) { return worksheet; });\n    } else if (typeof id === 'number') {\n      return this._worksheets[id];\n    } else if (typeof id === 'string') {\n      return this._worksheets.find(function(worksheet) {\n        return worksheet && worksheet.name === id;\n      });\n    }\n    return undefined;\n  },\n\n  get worksheets() {\n    // return a clone of _worksheets\n    return this._worksheets.slice(1).sort((a, b) => a.orderNo - b.orderNo).filter(Boolean);\n  },\n\n  eachSheet: function(iteratee) {\n    this.worksheets.forEach((sheet) => {\n      iteratee(sheet, sheet.id);\n    });\n  },\n\n  get definedNames() {\n    return this._definedNames;\n  },\n\n  clearThemes: function() {\n    // Note: themes are not an exposed feature, meddle at your peril!\n    this._themes = undefined;\n  },\n\n  addImage: function(image) {\n    // TODO:  validation?\n    var id = this.media.length;\n    this.media.push(\n      Object.assign(\n        {},\n        image,\n        { type: 'image' }\n      )\n    );\n    return id;\n  },\n\n  getImage(id) {\n    return this.media[id];\n  },\n\n  get model() {\n    return {\n      creator: this.creator || 'Unknown',\n      lastModifiedBy: this.lastModifiedBy || 'Unknown',\n      lastPrinted: this.lastPrinted,\n      created: this.created,\n      modified: this.modified,\n      properties: this.properties,\n      worksheets: this.worksheets.map(function(worksheet) { return worksheet.model; }),\n      sheets: this.worksheets.map(ws => ws.model).filter(Boolean),\n      definedNames: this._definedNames.model,\n      views: this.views,\n      company: this.company,\n      manager: this.manager,\n      title: this.title,\n      subject: this.subject,\n      keywords: this.keywords,\n      category: this.category,\n      description: this.description,\n      language: this.language,\n      revision: this.revision,\n      contentStatus: this.contentStatus,\n      themes: this._themes,\n      media: this.media,\n    };\n  },\n  set model(value) {\n    this.creator = value.creator;\n    this.lastModifiedBy = value.lastModifiedBy;\n    this.lastPrinted = value.lastPrinted;\n    this.created = value.created;\n    this.modified = value.modified;\n    this.company = value.company;\n    this.manager = value.manager;\n    this.title = value.title;\n    this.subject = value.subject;\n    this.keywords = value.keywords;\n    this.category = value.category;\n    this.description = value.description;\n    this.language = value.language;\n    this.revision = value.revision;\n    this.contentStatus = value.contentStatus;\n\n    this.properties = value.properties;\n    this._worksheets = [];\n    value.worksheets.forEach(worksheetModel => {\n      var id = worksheetModel.id;\n      var name = worksheetModel.name;\n      var orderNo = value.sheets.findIndex(ws => ws.id === id);\n      var worksheet = this._worksheets[id] = new Worksheet({\n        id: id,\n        name: name,\n        orderNo,\n        workbook: this\n      });\n\n      worksheet.model = worksheetModel;\n    });\n\n    this._definedNames.model = value.definedNames;\n    this.views = value.views;\n    this._themes = value.themes;\n    this.media = value.media || [];\n  }\n};\n"]}